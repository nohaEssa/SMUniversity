@{
    ViewBag.Title = "StudentProfile";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



@{
    string BRID = Session["BarnchID"].ToString();
    int USID = int.Parse(Session["UserID"].ToString());

    SmartMind.Models.SmartMindEntities DB = new SmartMind.Models.SmartMindEntities();

    int StudentID = int.Parse(Request.Params["STID"].ToString());

    var Student = DB.Tbl_Students.Where(a => a.StudentID == StudentID).Select(a => a).FirstOrDefault();


    ViewBag.Title = Student.firstName;
    string Password = System.Web.Security.Membership.GeneratePassword(12, 1);
}

<input type="hidden" value="@USID" id="LblUsIDForRe" />
<input type="hidden" value="تم السحب " id="LblNotesForRe" />
<input type="hidden" value="" id="LblDeletedConfirmation" />
<input type="hidden" value="" id="lblSubItem" />
<input type="hidden" value="" id="lblNewGroupID" />


<link href="~/Content/assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.css" rel="stylesheet" type="text/css" />
<link href="~/Content/assets/admin/pages/css/profile-rtl.css" rel="stylesheet" type="text/css" />
<link href="~/Content/assets/admin/pages/css/tasks-rtl.css" rel="stylesheet" type="text/css" />

<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <i class="fa fa-home"></i>
            <a href="@Url.Action("Index","Home")">الرئيسيه</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <i class="icon-users"></i>
            <a href="@Url.Action("Index", "Student")"> الطلاب  </a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <i class="fa  fa-pencil-square-o"></i>
            <a href="@Url.Action("StudentProfile", "Student", new { STID = Student.StudentID })"> @Student.firstName @Student.SecondName @Student.ThirdName</a>

        </li>

    </ul>

</div>
<input type="hidden" id="LblStudentID" value="@StudentID" />
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN PROFILE SIDEBAR -->
        <div class="profile-sidebar" style="width: 250px;">
            <!-- PORTLET MAIN -->
            <div class="portlet light profile-sidebar-portlet">
                <!-- SIDEBAR USERPIC -->
                <div class="profile-userpic">

                    <img src="~/Content/Images/@Student.ProfilePic" class="img-responsive" alt="">
                </div>
                <!-- END SIDEBAR USERPIC -->
                <!-- SIDEBAR USER TITLE -->
                <div class="profile-usertitle">
                    <div class="profile-usertitle-name">
                        @* @Student.firstName &nbsp; @Student.SecondName &nbsp; @Student.ThirdName*@
                        @Student.firstName @Student.SecondName @Student.ThirdName
                    </div>
                    <div class="profile-usertitle-job">
                        الصف : @Student.Tbl_Stages.StageName
                    </div>
                </div>
                <!-- END SIDEBAR USER TITLE -->
                <!-- SIDEBAR BUTTONS -->
                <div class="profile-userbuttons">

                    <a href="@Url.Action("Register", "Student", new { STID = Student.StudentID })" class="btn btn-circle green-haze btn-sm" style="width: 105px;"><i class="fa fa-book"></i> تسجيل مواد </a>

                    <a href="@Url.Action("Edit", "Student", new { STID = Student.StudentID })" class="btn btn-circle btn-primary btn-sm" style="width: 105px;"><i class="fa fa-edit"></i> تعديل </a>
                </div>
                <div class="profile-userbuttons">
                    <a href="@Url.Action("Print", "Student", new { StID=Student.StudentID })" class="btn btn-circle grey-cascade btn-sm" style="width: 105px;"><i class="fa fa-print"></i> الاستماره</a>

                    <a href="@Url.Action("Schedule", "Student", new { StID = Student.StudentID })" class="btn btn-circle green btn-sm" style="width: 105px;"><i class="fa fa-calendar"></i>  الجدول الدراسى</a>
                </div>
                <!-- END SIDEBAR BUTTONS -->
                <!-- SIDEBAR MENU -->
                <div class="profile-usermenu">
                    <ul class="nav">
                        <li class="active">
                            <a href="javascript:void(0)">
                                <i class="icon-call-end"></i>
                                @Student.Phone
                            </a>
                        </li>
                        <li class="active">
                            <a href="javascript:void(0)" target="_blank">
                                <i class="icon-envelope-letter"></i>
                                @Student.Email
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0)">
                                <i class=" icon-pointer"></i>
                                @Student.Area
                            </a>
                        </li>
                        @if (Student.Gender == true)
                        {
                            <li>
                                <a href="javascript:void(0)">
                                    <i class="icon-user"></i>
                                    ذكر
                                </a>
                            </li>
                        }
                        else
                        {
                            <li>
                                <a href="javascript:void(0)">
                                    <i class=" icon-user-female"></i>
                                    أنثى
                                </a>
                            </li>
                        }
                        <li>
                            <a href="javascript:void(0)">
                                <i class="icon-user-follow"></i>
                                @Student.ParentMobile1
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0)">
                                <i class="icon-user-follow"></i>
                                @Student.ParentMobile2
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0)">
                                <i class="icon-user-follow"></i>
                                @Student.ParentMobile3
                            </a>
                        </li>


                    </ul>
                </div>
                <!-- END MENU -->
            </div>
            <!-- END PORTLET MAIN -->
            <!-- PORTLET MAIN -->
            <div class="portlet light">
                <!-- STAT -->
                <div class="row list-separated profile-stat">
                    <div class="col-md-4 col-sm-4 col-xs-6">
                        <div class="uppercase profile-stat-title">
                            @DB.Tbl_SubscriptionItems.Where(a => a.Tbl_Subscription.StudentID == StudentID && a.Tbl_Subscription.IsWaiting == false && a.IsWating == false && a.IsDeleted == false && a.Ended_State != true).Count()
                        </div>
                        <div class="uppercase profile-stat-text">
                            المواد المسجله
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-4 col-xs-6">
                        <div class="uppercase profile-stat-title">
                            @DB.Tbl_SubscriptionItems.Where(a => a.Tbl_Subscription.StudentID == StudentID && a.Tbl_Subscription.IsWaiting == false && a.IsWating == false && a.IsDeleted == false && a.Ended_State == true).Count()
                        </div>
                        <div class="uppercase profile-stat-text">
                            المواد المنتهية
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-4 col-xs-6">
                        <div class="uppercase profile-stat-title">
                            @DB.Tbl_SubscriptionItems.Where(a => a.Tbl_Subscription.StudentID == StudentID && a.IsDeleted == true).Count()
                        </div>
                        <div class="uppercase profile-stat-text">
                            المواد المسحوبة
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-4 col-xs-6">
                        <div class="uppercase profile-stat-title">
                            @if (DB.Tbl_Subscription.Where(a => a.StudentID == StudentID && a.IsWaiting == false).Count() > 0)
                            {
                                <label>   @DB.Tbl_Subscription.Where(a => a.StudentID == StudentID).Sum(a => a.Paied) </label>
                            }
                            else
                            {
                                <label> 0 </label>
                            }

                        </div>
                        <div class="uppercase profile-stat-text">
                            المبالغ المدفوعه
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-4 col-xs-6">
                        <div class="uppercase profile-stat-title">
                            @if (DB.Tbl_Subscription.Where(a => a.StudentID == StudentID && a.IsWaiting == false).Count() > 0)
                            {
                                <label>   @DB.Tbl_Subscription.Where(a => a.StudentID == StudentID && a.IsWaiting == false).Sum(a => a.PaymentLeft) </label>
                            }
                            else
                            {
                                <label> 0 </label>
                            }
                        </div>
                        <div class="uppercase profile-stat-text">
                            المبالغ المتبقيه
                        </div>
                    </div>
                </div>
                <!-- END STAT -->
                <div>
                    <h4 class="profile-desc-title">توصيات هامه</h4>
                    <span class="profile-desc-text"> @Html.Raw(Student.Recommandition) </span>
                    <div class="margin-top-20 profile-desc-link">
                        <i class="fa fa-bank"></i>
                        @Student.Tbl_Area.AreaName
                    </div>
                    <div class="margin-top-20 profile-desc-link">
                        <i class="fa fa-building"></i>
                        @Student.School
                    </div>
                    <div class="margin-top-20 profile-desc-link">
                        <i class="icon-lock-open"></i>
                        @Student.UserName
                    </div>
                    <div class="margin-top-20 profile-desc-link">
                        <i class="icon-lock-open"></i>
                        @Student.Password
                    </div>
                </div>
            </div>
            <!-- END PORTLET MAIN -->
        </div>
        <!-- END BEGIN PROFILE SIDEBAR -->
        <!-- BEGIN PROFILE CONTENT -->
        <div class="profile-content">
            <div class="row">
                <div class="col-md-6">
                    <!-- BEGIN PORTLET -->
                    <div class="portlet light">
                        <div class="portlet-title tabbable-line">
                            <div class="caption caption-md">
                                <i class="icon-globe theme-font hide"></i>
                                <span class="caption-subject font-blue-madison bold uppercase">تقرير الحضور والغياب</span>
                            </div>
                            <ul class="nav nav-tabs">
                                <li class="active">
                                    <a href="#tab_1_1" data-toggle="tab">
                                        الحضور
                                    </a>
                                </li>
                                <li>
                                    <a href="#tab_1_2" data-toggle="tab">
                                        الغياب
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="portlet-body">
                            <!--BEGIN TABS-->
                            <div class="tab-content">
                                <div class="tab-pane active" id="tab_1_1">
                                    <div class="scroller" style="height: 320px;" data-always-visible="1" data-rail-visible1="0" data-handle-color="#D7DCE2">
                                        <ul class="feeds">
                                            @foreach (var item in DB.Tbl_StudentAttendance.Where(a => a.StudentID == StudentID && (a.Attend == 1 || a.Attend == 0)).Select(a => a).ToList())
                                            {
                                                <li>
                                                    <div class="col1">
                                                        <div class="cont">
                                                            <div class="cont-col1">
                                                                <div class="label label-sm label-success">
                                                                    <i class="fa fa-bell-o"></i>
                                                                </div>
                                                            </div>
                                                            <div class="cont-col2">
                                                                <div class="desc">
                                                                    @item.LattencyReason <span class="label label-sm label-info">
                                                                        @item.Tbl_Groups.GroupName&nbsp;&nbsp;&nbsp;
                                                                        @item.Tbl_Groups.Tbl_Subject.SubjectName
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col2">
                                                        <div class="date">
                                                            @item.Createdat.Value.ToString("yyyy-MM-dd")
                                                        </div>
                                                    </div>
                                                </li>
                                            }


                                        </ul>
                                    </div>
                                </div>
                                <div class="tab-pane" id="tab_1_2">
                                    <div class="scroller" style="height: 337px;" data-always-visible="1" data-rail-visible1="0" data-handle-color="#D7DCE2">
                                        <ul class="feeds">
                                            @foreach (var item in DB.Tbl_StudentAttendance.Where(a => a.StudentID == StudentID && a.Attend == 2).Select(a => a).ToList())
                                            {
                                                <li>
                                                    <div class="col1">
                                                        <div class="cont">
                                                            <div class="cont-col1">
                                                                <div class="label label-sm label-danger">
                                                                    <i class="fa fa-bolt"></i>
                                                                </div>
                                                            </div>
                                                            <div class="cont-col2">
                                                                <div class="desc">
                                                                    @item.AbsentReason <span class="label label-sm label-danger ">
                                                                        @item.Tbl_Groups.GroupName&nbsp;&nbsp;&nbsp; <i class="fa fa-share"></i>
                                                                        @item.Tbl_Groups.Tbl_Subject.SubjectName
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col2">
                                                        <div class="date">
                                                            @item.Createdat.Value.ToString("yyyy-MM-dd")
                                                        </div>
                                                    </div>
                                                </li>
                                            }
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <!--END TABS-->
                        </div>
                    </div>
                    <!-- END PORTLET -->
                </div>
                <div class="col-md-6">
                    <!-- BEGIN PORTLET -->
                    <div class="portlet light">
                        <div class="portlet-title">
                            <div class="caption caption-md">
                                <i class="icon-bar-chart theme-font hide"></i>
                                <span class="caption-subject font-blue-madison bold uppercase"> تقييم المعلمين </span>
                                <span class="caption-helper">@DB.Tbl_StudentRate.Where(a => a.StudentID == StudentID).Count() </span>
                            </div>

                        </div>
                        <div class="portlet-body">
                            <div class="scroller" style="height: 305px;" data-always-visible="1" data-rail-visible1="0" data-handle-color="#D7DCE2">
                                <div class="general-item-list">
                                    @foreach (var item in DB.Tbl_StudentRate.Where(a => a.StudentID == StudentID).ToList())
                                    {
                                        <div class="item">
                                            <div class="item-head">
                                                <div class="item-details">

                                                    <img class="item-pic" src="~/Content/Images/avatar.png">
                                                    <a href="" class="item-name primary-link"> @item.Tbl_Teacher.FirstName @item.Tbl_Teacher.SecondName @item.Tbl_Teacher.ThirdName</a>
                                                    <a href="" class="item-name primary-link"> @DB.Tbl_SubscriptionItems.Where(a => a.Tbl_Groups.TeacherID == item.TeacherID).Select(a => a.Tbl_Groups.Tbl_Subject.SubjectName).FirstOrDefault()</a>
                                                    <span class="item-label">@item.CreatedAt.Value</span>
                                                </div>
                                                <span class="item-status"><span class="badge badge-empty badge-success"> </span> </span>
                                            </div>
                                            <div class="item-body">
                                                @item.Comment
                                                ||
                                                @item.PerVal %
                                            </div>
                                        </div>
                                    }

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END PORTLET -->
                </div>


            </div>
            <div class="row">
                <div class="col-md-6" style="width: 100%;">
                    <!-- BEGIN PORTLET -->
                    <div class="portlet light tasks-widget">
                        <div class="portlet-title">
                            <div class="caption caption-md">
                                <i class="icon-bar-chart theme-font hide"></i>
                                <span class="caption-subject font-blue-madison bold uppercase"> المواد المسجله</span>
                                <span class="caption-helper hide">.</span>
                            </div>
                            <div class="inputs">
                                <div class="portlet-input input-small input-inline">
                                    <div class="input-icon right">
                                        @*<i class="icon-magnifier"></i>*@
                                        <select class="dropdown-dark" onchange="Javascript:GetSubscriptionByStudentAndMonth()" style="width: 100%;height: 39px;font-size: 17px;background-color: #31708f;color: aliceblue;" id="CHMontSelect">
                                            <option> بحث ب شهر البدايه   </option>

                                            @foreach (var item in DB.Tbl_Month.Select(a => a).ToList())
                                            {
                                                <option value="@item.TrainingMonthID"> @item.MonthName   </option>
                                            }

                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="portlet-body">
                            <div class="task-content">
                                <div class="scroller" style="height: 282px; width: 100%;" data-always-visible="1" data-rail-visible1="0" data-handle-color="#D7DCE2">
                                    <div class="table-scrollable table-scrollable-borderless">

                                        <span class="caption-subject font-blue-madison bold uppercase"> </span>
                                        <table class="table table-hover table-light" id="TblGroups">
                                            <thead>
                                                <tr class="uppercase">
                                                    <th style="text-align:right;">
                                                        اسم المجموعة
                                                    </th>
                                                    <th style="text-align:right;">
                                                        المادة الدراسية
                                                    </th>
                                                    <th style="text-align:right;">
                                                        اسم المدرس
                                                    </th>
                                                    <th>
                                                        تاريخ الانضمام
                                                    </th>
                                                    <th>
                                                        تاريخ الإنتهاء
                                                    </th>
                                                    @*<th>
                                                        سحب الطالب
                                                    </th>*@
                                                    <th>
                                                        تحويل
                                                    </th>
                                                    <th>
                                                        تجديد الإشتراك
                                                    </th>
                                                    <th>تجديد الكل</th>

                                                </tr>
                                            </thead>
                                            <tbody>
                                                @{
                                                    DateTime MDate = SmartMind.Classes.DateTimeDependsOnTimeZone.GetDate();

                                                    var RunningSubs = DB.Tbl_SubscriptionItems.Where(a => a.Tbl_Subscription.StudentID == StudentID && a.IsWating == false && a.Tbl_Subscription.IsWaiting == false && a.Ended_State != true).Select(a => a).ToList();
                                                    foreach (var item in RunningSubs)
                                                    {
                                                        <tr>
                                                            <td style="text-align:right;"> @item.Tbl_Groups.GroupName </td>

                                                            <td class="fit" style="text-align:right;"> @item.Tbl_Groups.Tbl_Subject.SubjectName </td>
                                                            <td class="fit" style="text-align:right;"> @item.Tbl_Groups.Tbl_Teacher.FirstName @item.Tbl_Groups.Tbl_Teacher.SecondName @item.Tbl_Groups.Tbl_Teacher.ThirdName</td>

                                                            <td style="text-align:right;"> @item.Tbl_Subscription.StartDate</td>
                                                            <td style="text-align:right;"> @item.Tbl_Subscription.EndDate</td>

                                                            @*@if (item.IsDeleted == true)
                                                            {
                                                                <td><p style="color:red;"> تم السحب </p></td>
                                                            }
                                                            else
                                                            {
                                                                <td><a class="btn btn-circle btn-xs red abdoU tooltips" data-toggle="modal" href="#Adohjh" data-container="body" data-placement="right" data-original-title="سحب الطالب " onclick='javascript:GoToDeleteSTU("@item.Sub_ItemID");'>  سحب </a></td>
                                                                <td>

                                                                    <a href='#' class='btn btn-circle default hidden-print blue-stripe' data-toggle='modal' data-target='#basic' onclick='javascript:GetGroupForTransfer(@item.Tbl_Groups.ProgramID, @item.Tbl_Groups.GroupType, @item.Tbl_Subscription.Tbl_Students.BranchID, @item.Tbl_Subscription.StudentID, @item.Sub_ItemID );'><i class='fa fa-edit'></i> تحويل لمجموعة أخري </a>
                                                                </td>

                                                                <td>
                                                                    <a href="/Student/RenewSubscriptionView?sub=@item.Sub_ItemID" class='btn btn-icon-only btn-circle green tooltips' data-container='body' data-placement='right' data-original-title='تجديد إشتراك'> <i class='fa fa-book'></i>  </a>
                                                                </td>

                                                            }*@

                                                            @if (item.IsDeleted != true)
                                                            {
                                                                <td>

                                                                    <a href='#' class='btn btn-circle default hidden-print blue-stripe' data-toggle='modal' data-target='#basic' onclick='javascript:GetGroupForTransfer(@item.Tbl_Groups.ProgramID, @item.Tbl_Groups.GroupType, @item.Tbl_Subscription.Tbl_Students.BranchID, @item.Tbl_Subscription.StudentID, @item.Sub_ItemID );'><i class='fa fa-edit'></i> تحويل لمجموعة أخري </a>
                                                                </td>

                                                                <td>
                                                                    <a href="/Student/RenewSubscriptionView?sub=@item.Sub_ItemID" class='btn btn-icon-only btn-circle green tooltips' data-container='body' data-placement='right' data-original-title='تجديد إشتراك'> <i class='fa fa-book'></i>  </a>
                                                                </td>
                                                            }
                                                        </tr>
                                                    }

                                                    //var subscriptions = DB.Tbl_Subscription.Where(a => a.StudentID == StudentID).ToList();
                                                    string subIDs = "";


                                                    foreach (var item in RunningSubs)
                                                    {
                                                        subIDs += item.Tbl_Subscription.Sub_ID + ",";
                                                    }

                                                    <tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
														<td></td>
														<td></td>
                                                        <td><a href="/Student/RenewMultipleSubscriptionView?subscriptions=@subIDs" class='btn btn-icon-only btn-circle green tooltips' data-container='body' data-placement='right' data-original-title='تجديد إشتراك'> <i class='fa fa-book'></i>  </a></td>
                                                    </tr>

                                                }



                                            </tbody>
                                        </table>
                                    </div>

                                    <!-- START TASK LIST -->
                                    <!-- END START TASK LIST -->
                                </div>
                            </div>
                            <div class="task-footer">
                                <div class="btn-arrow-link pull-right">

                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- BEGIN PORTLET -->
                    <div class="portlet light tasks-widget">
                        <div class="portlet-title">
                            <div class="caption caption-md">
                                <i class="icon-bar-chart theme-font hide"></i>
                                <span class="caption-subject font-blue-madison bold uppercase"> المواد المنتهية</span>
                                <span class="caption-helper hide">.</span>
                            </div>
                            <div class="inputs">
                                <div class="portlet-input input-small input-inline">
                                    <div class="input-icon right">
                                        @*<i class="icon-magnifier"></i>*@
                                        <select class="dropdown-dark" onchange="javascript:GetEndedSubscriptionByStudentAndMonth();" style="width: 100%;height: 39px;font-size: 17px;background-color: #31708f;color: aliceblue;" id="CHMontSelect2">
                                            <option> بحث ب شهر البدايه   </option>
                                            @foreach (var item in DB.Tbl_Month.Select(a => a).ToList())
                                            {
                                                <option value="@item.TrainingMonthID"> @item.MonthName   </option>
                                            }
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="portlet-body">
                            <div class="task-content">
                                <div class="scroller" style="height: 282px; width: 100%;" data-always-visible="1" data-rail-visible1="0" data-handle-color="#D7DCE2">
                                    <div class="table-scrollable table-scrollable-borderless">

                                        <span class="caption-subject font-blue-madison bold uppercase"> </span>
                                        <table class="table table-hover table-light" id="TblGroups2">
                                            <thead>
                                                <tr class="uppercase">
                                                    <th style="text-align:right;">
                                                        اسم المجموعة
                                                    </th>
                                                    <th style="text-align:right;">
                                                        المادة الدراسية
                                                    </th>
                                                    <th style="text-align:right;">
                                                        اسم المدرس
                                                    </th>
                                                    <th>
                                                        تاريخ الانضمام
                                                    </th>
                                                    <th>
                                                        تاريخ الإنتهاء
                                                    </th>
                                                    <th>
                                                        الحالة
                                                    </th>
                                                    <th>
                                                        تجديد الإشتراك
                                                    </th>
                                                    <th>تجديد الكل</th>

                                                </tr>
                                            </thead>
                                            <tbody>
                                                @{
                                                    var subItems = DB.Tbl_SubscriptionItems.Where(a => a.Tbl_Subscription.StudentID == StudentID && a.IsWating == false && a.Tbl_Subscription.IsWaiting == false && a.Tbl_Subscription.Ended_State == true).ToList();

                                                    foreach (var item in subItems)
                                                    {
                                                        <tr>
                                                            <td style="text-align:right;"> @item.Tbl_Groups.GroupName </td>

                                                            <td class="fit" style="text-align:right;"> @item.Tbl_Groups.Tbl_Subject.SubjectName </td>
                                                            <td class="fit" style="text-align:right;"> @item.Tbl_Groups.Tbl_Teacher.FirstName @item.Tbl_Groups.Tbl_Teacher.SecondName @item.Tbl_Groups.Tbl_Teacher.ThirdName</td>

                                                            <td style="text-align:right;"> @item.Tbl_Subscription.StartDate</td>
                                                            <td style="text-align:right;"> @item.Tbl_Subscription.EndDate</td>

                                                            <td>
                                                                <p style="color:red;">إنتهت</p>
                                                            </td>
                                                            <td>
                                                                <a href="/Student/RenewSubscriptionView?sub=@item.Sub_ItemID" class='btn btn-icon-only btn-circle green tooltips' data-container='body' data-placement='right' data-original-title='تجديد إشتراك'> <i class='fa fa-book'></i>  </a>
                                                            </td>
                                                        </tr>
                                                    }

                                                    //var EndedSubscriptions = DB.Tbl_Subscription.Where(a => a.StudentID == StudentID).ToList();
                                                    string EndedSubIDs = "";


                                                    foreach (var item in subItems)
                                                    {
                                                        EndedSubIDs += item.Tbl_Subscription.Sub_ID + ",";
                                                    }

                                                    <tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        @if (subItems.Count > 0)
                                                        {
                                                            <td><a href="/Student/RenewMultipleSubscriptionView?subscriptions=@EndedSubIDs" class='btn btn-icon-only btn-circle green tooltips' data-container='body' data-placement='right' data-original-title='تجديد إشتراك'> <i class='fa fa-book'></i>  </a></td>

                                                        }
                                                        else
                                                        {
                                                            <td></td>
                                                        }
                                                    </tr>

                                                }
                                            </tbody>
                                        </table>
                                    </div>

                                    <!-- START TASK LIST -->
                                    <!-- END START TASK LIST -->
                                </div>
                            </div>
                            <div class="task-footer">
                                <div class="btn-arrow-link pull-right">

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END PORTLET -->

                    <div class="modal fade" id="basic" tabindex="-1" role="note" aria-hidden="true">
                        <div class="modal-dialog" style=" width: 800px; ">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                    <label class="modal-title text-align: center;"> تحويل من مجموعة لمجموعة أخري </label>
                                </div>
                                <br />
                                <hr />
                                <div class="row">
                                    <div class="col-md-12">
                                        <!-- BEGIN EXAMPLE TABLE PORTLET-->
                                        <div class="portlet box blue-hoki">
                                            <div class="portlet-title">
                                                <div class="caption">
                                                    <i class="icon-users"></i>  @*تقرير المجموعات*@
                                                </div>
                                                <div class="tools">
                                                </div>
                                            </div>
                                            <div class="portlet-body">
                                                <table class="table table-striped table-bordered table-hover" style="width:100%" id="sample_2">
                                                    <thead>
                                                        <tr>
                                                            <th>#</th>
                                                            <th>
                                                                اسم المجموعة
                                                            </th>
                                                            <th>
                                                                اسم المادة الدراسية
                                                            </th>
                                                            <th>
                                                                اسم المدرس
                                                            </th>
                                                            <th>
                                                                الأوقات / الأيام
                                                            </th>
                                                            <th>
                                                                القاعة
                                                            </th>
                                                            <th>
                                                                عدد المقاعد
                                                            </th>
                                                            <th>
                                                                المقاعد المتاحة

                                                            </th>
                                                            <th>
                                                                الحاله

                                                            </th>
                                                            <th>

                                                            </th>

                                                        </tr>
                                                    </thead>
                                                    <tbody id="GroupsTable"></tbody>

                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <hr />
                                <br />
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-circle red">إلغاء</button>
                                </div>
                            </div>
                            <!-- /.modal-content -->
                        </div>
                        <!-- /.modal-dialog -->
                    </div>

                    @*تجديد الإشتراك*@
                    <div class="modal fade" id="basic" tabindex="-1" role="note" aria-hidden="true">
                        <input type="hidden" value="" id="TxtGroupID" />
                        <input type="hidden" value="TxtStudentID" />

                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                    <label class="modal-title text-align: center;"> تجديد الإشتراك </label>
                                </div>
                                <br />
                                <hr />
                                <div class="row">
                                    <div class="col-md-12">
                                        <!-- BEGIN EXAMPLE TABLE PORTLET-->
                                        <div class="portlet box blue-hoki">
                                            <div class="portlet-title">
                                                <div class="caption">
                                                    <i class="icon-users"></i>  تجديد الإشتراك
                                                </div>
                                                <div class="tools">
                                                </div>
                                            </div>


                                            <div class="portlet-body">


                                                <div class="form-group">
                                                    <label class="control-label col-md-1"></label>

                                                    <div class="col-md-2">

                                                        <label>
                                                            <input type="checkbox" value="0" name="IsCoursConfirm" id="IsCoursConfirm" onchange="javascript: SetCoursConfirm();"> كورس
                                                        </label>

                                                    </div>
                                                    <label class="control-label col-md-3">بداية الاشتراك</label>
                                                    <div class="col-md-4">
                                                        <div class="input-group input-large date-picker input-daterange" data-date="10/11/2012" data-date-format="mm/dd/yyyy">
                                                            <input type="text" class="form-control" name="from" id="TxtDateFrom">
                                                            <span class="input-group-addon">
                                                                الى
                                                            </span>
                                                            <input type="text" class="form-control" name="to" id="TxtDateTo">
                                                        </div>
                                                        <!-- /input-group -->
                                                        <span class="help-block">
                                                            من فضلك اختار المده من الى لتحديد عدد شهور الكورس
                                                        </span>
                                                    </div>
                                                </div>


                                                <div class="form-group">
                                                    <label class="control-label col-md-1">إشتراك شهر</label>
                                                    <div class="col-md-2">
                                                        *<select class="select2_category form-control" id="CHmonth" required>
                                                            <option></option>
                                                            @foreach (var item in DB.Tbl_Month.Select(a => a).ToList())
                                                            {
                                                                <option value="@item.TrainingMonthID">@item.MonthName </option>
                                                            }
                                                        </select>
                                                    </div>

                                                </div>
                                            </div>


                                            <div class="col-md-8">
                                                <div class="portlet box green">
                                                    <div class="portlet-title">
                                                        <div class="caption">
                                                            <i class=" icon-credit-card"></i>
                                                            الدفع
                                                        </div>
                                                        <div class="tools">
                                                            <a href="javascript:;" class="collapse">
                                                            </a>
                                                            <a href="#portlet-config" data-toggle="modal" class="config">
                                                            </a>
                                                        </div>
                                                    </div>
                                                    <div class="portlet-body form">
                                                        <form action="javascript:RenewSubscription();" id="FRPayment" class="form-horizontal form-bordered">
                                                            <input type="hidden" value="0" id="LblTotalDiscountCalc" />
                                                            <div class="form-body">
                                                                <div class="form-group">
                                                                    <div class="col-md-2" style="display:none;">
                                                                        <label>
                                                                            <input type="checkbox" value="0" name="Static" id="ChststicPrice" onchange="Javascript: StaticPricCalc();"> سعر ثابت
                                                                        </label>
                                                                    </div>

                                                                    <div class="col-md-2">
                                                                        <input type="text" class="form-control input-circle" id="TxtGrSubPrice" value="0" disabled onchange="Javascript: ResetBeforStatic();">
                                                                        <span class="help-block">
                                                                            اجمالى ثمن المواد المقدمه
                                                                        </span>
                                                                    </div>
                                                                    <label class="col-md-2 control-label">قيمة الخصم</label>
                                                                    <div class="col-md-2">
                                                                        <input type="text" class="form-control input-circle" id="TxtHoursDis" placeholder="عدد الساعات">
                                                                        <span class="help-block">
                                                                            عدد ساعات الخصم
                                                                        </span>
                                                                    </div>
                                                                    <div class="col-md-2">
                                                                        <input type="text" class="form-control input-circle" id="TxtHourPrice" placeholder="سعر الساعه" onchange="Javascript: GetHouresDisCoo();">
                                                                        <span class="help-block">
                                                                            سعر الساعه
                                                                        </span>
                                                                    </div>
                                                                    <div class="col-md-2">
                                                                        <input type="hidden" id="KHhf" />
                                                                        <input type="text" class="form-control input-circle" id="TxtDiscount" value="0" onchange="javascript: GatDiscountValue();">
                                                                        <span class="help-block">
                                                                            خصم قيمة ايام -  خصم قيمه من الاجمالى
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group">

                                                                    <label class="col-md-2 control-label">
                                                                        <input type="checkbox" value="0" name="Bitch" id="CHCancelBitch" onchange="Javascript: ISeeYouBitch();"> إلغاء الكود
                                                                    </label>
                                                                    <div class="col-md-4">
                                                                        <input type="hidden" id="VaikJhf" value="0" />
                                                                        <input type="hidden" id="LblBitchVal" />
                                                                        <input type="text" class="form-control input-circle" id="TxtEmaraDiscount" value="0" onchange="Javascript: EmaraDiscountCalculate();">
                                                                        <span class="help-block">
                                                                            من فضلك أدخل الرقم الكودى
                                                                        </span>
                                                                    </div>
                                                                    <label class="col-md-2 control-label">  </label>
                                                                    <div class="col-md-4">

                                                                        <label>
                                                                            <input type="hidden" id="LblDofaaaaDiscount" />
                                                                            <input type="checkbox" value="0" name="BrazzersDiscount" id="ChBrazDiscount" onchange="Javascript: BrazzersCulcPersent();"> خصم الدفعه
                                                                        </label>
                                                                        <span class="help-block">
                                                                            يخصم قيمة 10 %
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group">

                                                                    <label class="col-md-2 control-label">  </label>
                                                                    <div class="col-md-4">

                                                                        <label>
                                                                            <input type="hidden" id="LblBra15Val" />
                                                                            <input type="checkbox" value="0" name="BrazzersDiscount" id="ChBrazDiscountdf" onchange="Javascript: BrazzersCulcPersentBraz();"> خصم  الأخوة
                                                                        </label>
                                                                        <span class="help-block">
                                                                            يخصم قيمة 15 %
                                                                        </span>
                                                                    </div>
                                                                    <div class="col-md-4">

                                                                        <label>
                                                                            <input type="hidden" id="LblBra10Val" />
                                                                            <input type="checkbox" value="0" name="BrazzersDiscount" id="ChBrazDiscountdfdd" onchange="Javascript: Firughg10();"> خصم الأخوة
                                                                        </label>
                                                                        <span class="help-block">
                                                                            يخصم قيمة 10 %
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="col-md-2 control-label"> المجموع </label>
                                                                    <div class="col-md-4">
                                                                        <input type="text" class="form-control input-circle" id="TxtTotalPrice" value="0" disabled>

                                                                    </div>

                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="col-md-2 control-label">طريقة الدفع 1 </label>
                                                                    <div class="col-md-4">
                                                                        <select id="ChpaymentMethod" class="select2_category form-control" tabindex="1">
                                                                            <option value="cash">نقداً</option>
                                                                            <option value="knet">كي نت</option>
                                                                            <option value="credit_card">ماستر / فيزا</option>
                                                                        </select>

                                                                    </div>
                                                                    <label class="col-md-2 control-label"> 1 المدفوع </label>
                                                                    <div class="col-md-4">
                                                                        <input type="number" class="form-control input-circle" id="TxtPaid" value="0" onchange="javascript: GetStudentDebit();" required>

                                                                    </div>


                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="col-md-2 control-label">طريقة الدفع 2 </label>
                                                                    <div class="col-md-4">
                                                                        <select id="ChpaymentMethod2" class="select2_category form-control" tabindex="1">
                                                                            <option value="cash">نقداً</option>
                                                                            <option value="knet">كي نت</option>
                                                                            <option value="credit_card">ماستر / فيزا</option>
                                                                        </select>

                                                                    </div>
                                                                    <label class="col-md-2 control-label"> 2 المدفوع </label>
                                                                    <div class="col-md-4">
                                                                        <input type="number" class="form-control input-circle" id="TxtPaid2" value="0" onchange="javascript: GetStudentDebit();" required step="0.01">

                                                                    </div>

                                                                </div>
                                                                <div class="form-group">

                                                                    <label class="col-md-2 control-label"> المبلغ المتبقى  </label>
                                                                    <div class="col-md-4">

                                                                        <input type="text" class="form-control input-circle" id="TxtDibet" disabled>
                                                                        <span class="help-block">
                                                                            سوف يتم حفظه كا دين على الطالب
                                                                        </span>
                                                                    </div>
                                                                    <label class="col-md-2 control-label"> تاريخ استحقاق الدين  </label>
                                                                    <div class="col-md-4">

                                                                        <input type="date" class="form-control input-circle" id="DtDibitDate">
                                                                        <span class="help-block">
                                                                            إذا كان هناك مديونيه على الطالب من فضلك ادخل تاريخ الاستحقاق
                                                                        </span>
                                                                        <div hidden="hidden" id="ErrorMsg">
                                                                            <span style="color:red" class="help-block" id="faultAlert">
                                                                                يجب إختيار تاريخ بعد تاريخ اليوم
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="form-group">
                                                                    <label class="col-md-2 control-labe4">  ملاحظات</label>
                                                                    <div class="col-md-8">
                                                                        <textarea rows="6" style="width:100%" id="TxtNotesVal"></textarea>
                                                                    </div>

                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="col-md-2 control-labe4">  </label>
                                                                    <div class="col-md-4">
                                                                        <input type="submit" class="btn btn-circle default green-stripe" id="BtnDontNoiseMeFucker" style="width:120px;" value="دفع" />
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </form>

                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>

                                <hr />
                                <br />
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-circle red" data-dismiss="modal">إلغاء</button>
                                </div>
                            </div>
                            <!-- /.modal-content -->
                        </div>
                        <!-- /.modal-dialog -->
                    </div>

                    <!-- END PORTLET -->
                </div>
                <div class="col-md-6" style="width: 100%;">
                    <!-- BEGIN PORTLET -->
                    <div class="portlet light ">
                        <div class="portlet-title">
                            <div class="caption caption-md">
                                <i class="icon-bar-chart theme-font hide"></i>
                                <span class="caption-subject font-blue-madison bold uppercase">الفواتير</span>
                                <span class="caption-helper "> التعاملات الماليه</span>
                            </div>
                            @*<div class="actions">
                                    <div class="btn-group btn-group-devided" data-toggle="buttons">
                                        <label class="btn btn-transparent grey-salsa btn-circle btn-sm active">
                                            <input type="radio" name="options" class="toggle" id="option1">Today
                                        </label>
                                        <label class="btn btn-transparent grey-salsa btn-circle btn-sm">
                                            <input type="radio" name="options" class="toggle" id="option2">Week
                                        </label>
                                        <label class="btn btn-transparent grey-salsa btn-circle btn-sm">
                                            <input type="radio" name="options" class="toggle" id="option2">Month
                                        </label>
                                    </div>
                                </div>*@
                        </div>
                        <div class="portlet-body">
                            <div class="row number-stats margin-bottom-30">
                                <div class="col-md-12 col-sm-12 col-xs-12">

                                    <span class="caption-subject font-blue-madison bold uppercase">المبالغ المستحقه</span>
                                    <table class="table table-hover table-light">
                                        <thead>
                                            <tr class="uppercase">
                                                <th colspan="2">
                                                    المواد الدراسيه
                                                </th>
                                                <th>
                                                    تاريخ الاشتراك
                                                </th>
                                                <th>
                                                    المبلغ المتبقى
                                                </th>

                                                <th>
                                                    دفع
                                                </th>
                                            </tr>
                                        </thead>
                                        @{
                                            string Subjects = "";
                                        }
                                        @foreach (var item in DB.Tbl_Subscription.Where(a => a.StudentID == StudentID && a.PaymentLeft > 0 && a.IsWaiting == false).Select(a => a).ToList())
                                        {
                                            <tr>
                                                @foreach (var SUb in DB.Tbl_SubscriptionItems.Where(a => a.SubscriptionID == item.Sub_ID && a.IsWating == false).Select(a => a).ToList())
                                                {
                                                    Subjects += SUb.Tbl_Groups.Tbl_Subject.SubjectName + "/";
                                                }
                                                <td style="text-align:right;">@Subjects</td>
                                                <td></td>
                                                <td class="fit" style="text-align:right;"> @item.Createdat.Value.ToShortDateString() </td>
                                                <td style="text-align:right;"> @item.PaymentLeft </td>

                                                <td>
                                                    <a class="btn btn-circle btn-xs green" href="@Url.Action("Create", "Invoices", new {Code = item.Sub_ID })"><i class="fa fa-money"></i> دفع</a>
                                                </td>

                                            </tr>
                                        }


                                    </table>
                                </div>
                                @*<div class="col-md-6 col-sm-6 col-xs-6">
                                        <div class="stat-right">
                                            <div class="stat-chart">

                                                <div id="sparkline_bar2"></div>
                                            </div>
                                            <div class="stat-number">
                                                <div class="title">
                                                    New
                                                </div>
                                                <div class="number">
                                                    719
                                                </div>
                                            </div>
                                        </div>
                                    </div>*@
                            </div>

                            <div class="table-scrollable table-scrollable-borderless">

                                <span class="caption-subject font-blue-madison bold uppercase"> الفواتير </span>
                                <table class="table table-hover table-light">
                                    <thead>
                                        <tr class="uppercase">
                                            <th>
                                                #
                                            </th>
                                            <th>
                                                المبلغ المدفوع
                                            </th>
                                            <th>
                                                تاريخ الدفع
                                            </th>

                                            <th>
                                                عرض
                                            </th>
                                        </tr>
                                    </thead>
                                    @{
                                        var invoices = DB.Tbl_Invoices.Where(a => a.Tbl_Subscription.StudentID == StudentID).ToList();

                                        foreach (var item in invoices)
                                        {
                                            <tr>
                                                <td style="text-align:right;">@item.Serial</td>
                                                <td style="text-align:right;"> @DB.Tbl_Payment.Where(a => a.InvoiceID == item.InvoiceID).Sum(a => a.Amount) KWD </td>

                                                <td class="fit" style="text-align:right;"> @item.Createat.Value.ToShortDateString() </td>

                                                <td><a class="btn btn-circle btn-xs blue" href="@Url.Action("Invoice", "Invoices", new { INID = item.InvoiceID, Type="0" })"><i class="fa fa-bar-chart-o"></i> عرض</a></td>

                                            </tr>
                                        }
                                    }

                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- END PORTLET -->
                </div>


            </div>
        </div>
        <!-- END PROFILE CONTENT -->
    </div>
</div>

<script src="~/Content/assets/global/plugins/bootstrap-confirmation/bootstrap-confirmation.min.js" type="text/javascript"></script>

<script src="~/Content/assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js" type="text/javascript"></script>
<script src="~/Content/assets/global/plugins/jquery.sparkline.min.js" type="text/javascript"></script>
<script src="~/Content/assets/admin/pages/scripts/profile.js" type="text/javascript"></script>

<script src="~/Scripts/Students/Profile.js"></script>


<div class="modal fade" id="Adohjh" tabindex="-1" role="Adohjh" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">سحب الطالب</h4>
            </div>
            <div class="modal-body">

                <h3>
                    هل انت متاكد من سحب الطالب من المجموعه
                </h3>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-circle red" data-dismiss="modal">إلغاء</button>
                <button type="button" class="btn btn-circle green" onclick="Javascript: DeleteSubjectFromSubscription();"> سحب الطالب </button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

